<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>web3.js</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="web3.js API Documentation">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple-dark.css" />
    <link rel="stylesheet" href="./custom.css" type="text/css"/>
    <link rel="stylesheet" href="./hybrid.css" type="text/css"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono" rel="stylesheet">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
  </head>
  <body>
    <div id="app"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="./config.js"></script>
    <script>
      function attachClick() {
        $(".btn").on("click", function(){
          var iframeLoad = $(this).parent()[0].children[1];
          $(iframeLoad).attr("src",$(iframeLoad).attr("data-src")).removeAttr("data-src").show(300);
          $(this).hide();
          $(this).parent().css("border", "4px var(--mono-tint2) solid");
        })
      }
      function setStatic() {
        $("codesandbox").each(function() {
          var el = $(this);
          var path = el.attr("example");
          var url = `https://raw.githubusercontent.com/${config.orgName}/${config.repoName}/${config.branch}/example-src/packages/${path}/index.js`;
          $.get(url, function(data)Â {
            el.text(data.match(/{\n(.*)return.*}/s)[1].slice(0,-2));
            document.querySelectorAll('codesandbox').forEach((block) => {
              hljs.highlightBlock(block);
            });
          });

        })
      }
    </script>
    <script>
      $(document).ready(function() {
        attachClick();
        setStatic();
        $("aside").on("click", function(){
          attachClick();
          setStatic();
        });
      });
    </script>
    <script>
      window.$docsify = {
        loadSidebar: true,
        auto2top: true,
        autoHeader: false,
        subMaxLevel: 2,
        themeColor: '#c99d66',
        name: 'Web3.js API Docs',
        repo: 'https://github.com/ethereum/web3.js'
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.5.1/intersection-observer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@11.0.6/dist/lazyload.min.js"></script>
    <script src="//unpkg.com/docsify/lib/docsify.min.js"></script>
    <script src="//unpkg.com/docsify-copy-code@2"></script>
    <script src="//unpkg.com/docsify-pagination/dist/docsify-pagination.min.js"></script>
    <script src="//unpkg.com/docsify/lib/plugins/search.min.js"></script>
    <script>
      window.$docsify.plugins = (window.$docsify.plugins||[]).concat([
        function(hook, vm) {
          var tagRegex = /<codesandbox.*>(\s+)?([^\s]*)(\s+)?<\/codesandbox>/g;
          var cleanup = function(html) {
            return html.replace(tagRegex, '<codesandbox example="$2" class="javascript"></codesandbox>');
          }
          var embed = function(html) {
            var iframe = (
              `<codesandbox>$2</codesandbox><div style="display: flex; justify-content: center;">
                <button class="btn btn-web3js">Load CodeSandbox</button>
                <iframe
                  data-src="https://codesandbox.io/embed/github/${config.orgName}/${config.repoName}/tree/${config.branch}/example-src/packages/$2?fontsize=12&hidenavigation=1&view=editor&codemirror=1&runonclick=1&editorsize=60"
                  style="margin: 0px; display:none; width:100%; height:300px; border:2px; border-radius: 4px; overflow:hidden;"
                  sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"
                ></iframe>
              </div>`
            );
            return html.replace(tagRegex, iframe);
          }
          hook.beforeEach(function(content){
            return content.replace(tagRegex, `#### Example\n<codesandbox>$2</codesandbox>`)
          });
          hook.afterEach(function(html, next){
            next(cleanup(embed(html)));
          });
        },
      ]);
    </script>
  </body>
</html>
